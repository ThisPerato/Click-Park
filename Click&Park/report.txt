All’interno della cartella ProgettoFinale, sono contenuti tutti i file necessari al corretto funzionamento del sito Click & Park. In particolare, i file sono stati suddivisi in base alla loro estensione e alla loro funzione finale (es. ProgettoFinale/login/index.html definisce la pagina html relativa al login) , ad eccezione di alcuni file, i quali servono per definire la pagina iniziale del sito.

ProgettoFinale/index.php: tale file definisce l’operazione principale che il sito offre: in particolare, dopo essersi connesso al database, cattura i valori inseriti nei vari campi della form, definisce l’user id come 0000000000 (in quanto l’utente non risulta registrato a questo punto), memorizzandolo come variabile di sessione, determina anche l’id della transazione in corso come un numero casuale da scegliere fra 0000000000 e 9999999999 ed infine, in base al tipo di ricerca effettuata (tramite lista o inserimento) inserisce una tupla contenente le varie informazioni richieste nella tabella Storico del database contenente tutte le operazioni dall’utente specificato (user_id, id_transazione, ora_arrivo, ora_partenza, targa). Si noti, tuttavia, che in questo caso, poichè l’utente non è stato registrato, l’operazione verrà registrata ma subito eliminata. Ciò avviene per la ricerca tramite lista: alternativamente, tramite la ricerca mediante inserimento, prima di eseguire tale operazione, viene eseguita una query in modo tale da verificare se effettivamente la via inserita risulti associata ad un municipio di Roma: in caso di controllo fallito, si viene reindirizzati alla pagina corrente. Se l’operazione è andata a buon fine, si viene reindirizzati su una pagina che mostra di fatto un riepilogo dei dati inseriti.

ProgettoFinale/accesso_effettuato/index.php: in tale file, si segue il procedimento visto per il file precedente, con una differenza sostanziale: a tale file si accede dopo aver effettuato l’accesso, per cui l’user id non sarà più 0000000000, ma verrà prelevato dalla variabile di sessione inizializzata nel file index.php relativo al login.

ProgettoFinale/aggiungi parcheggio/index.php: dopo essersi connessi al database e prelevato i valori contenuti nei campi della form, viene verificato se tale via risulta già presente nel database mediante una query: in caso di esito negativo, si viene reindirizzati ad una pagina di errore, mentre in caso di esito positivo, viene eseguito l’inserimento e si viene reindirizzati su una pagina di successo.

ProgettoFinale/login/index.php: in base alla scelta effettuata nel form precedente si seguono diverse strade, con alcuni aspetti in comune tuttavia: in caso di registrazione, si prelevano i valori inseriti nel form, si determina l’user id come numero casuale nel range visto in precedenza, viene verificato se esistono utenti registrati con l’email inserita: in caso negativo, viene stampato un messaggio di errore. Altrimenti, si genera l’hash della password inserita e si procede all’inserimento di tale tupla (contenente user_id, nome, cognome, email e password) nella tabella Utente contenente tutti i dati degli utenti registrati. In seguito, si memorizzano i valori inseriti della form come variabili di sessione e si verrà reindirizzati alla pagina index.html relativo all’accesso effettuato. In caso di accesso, viene prelevato il valore inserito nel campo email e viene verificato se effettivamente è presente un utente nel database con tale email: in caso di controllo fallito, si viene reindirizzati alla pagina index.html relativa al form. Altrimenti, viene prelevata la password relativo a tale account e viene effettuato un confronto fra essa e la password inserita nel form: se combaciano, allora vengono prelevate le info relative a tale account e salvate come variabili di sessione, per poi procedere al reindirizzamento. In caso di discrepanza, si viene reindirizzati sulla pagina del form.

ProgettoFinale/logout/index.php: in tale file, vengono distrutte le variabili di sessione usate e si esegue il reindirizzamento alla pagina home in cui l’utente non risulta più registrato.

ProgettoFinale/modifica_dati_account/elimina_veicolo/index.php: in tale file, vengono prelevati il valore inserito come targa e le variabili di sessione indicanti l’user id e il nome dell’utente registrato. Tramite una query viene verificato se nella tabella Storico del database sono presenti transazioni che riguardino tale targa effettuate dall’utente con tale user_id. In caso non si trovino corrispondenze, si viene reindirizzati ad una pagina di errore, altrimenti si procede all’eliminazione delle tuple interessate per poi essere reindirizzati ad una pagina di successo. Tutto ciò non può avvenire se l’utente non risulta aver effettuato l’accesso al sito.

ProgettoFinale/modifica_dati_account/modifica_email/index.php: in tale file, dopo essersi accertato dell’effettivo accesso eseguito dall’utente, vengono prelevati i valori inseriti nel form e le variabili di sessione relativi all’user id e al nome. Una volta connessi al database. viene eseguita una query in modo tale da accertarsi se effettivamente è presente un utente con email uguale a $oldemail: in caso positivo, viene eseguito un confronto fra l’hash della password fornita dall’utente con quello nel database. Se non vengono riscontrate discrepanze, si procede ad una seconda query in cui viene verificato che non esistano utenti registrati con email uguale a $newemail. Nel caso in cui uno dei due controlli fallisca, si viene reindirizzati alla pagina di errore, altrimenti l’operazione di modifica della tupla inserita nella tabella Utenti viene eseguita correttamente e si viene reindirizzati alla pagina di successo.

ProgettoFinale/modifica_dati_account/modifica_operazione/index.php: in tale file, dopo essersi accertato dell’effettivo accesso eseguito dall’utente, vengono prelevati i valori inseriti nel form e le variabili di sessione relativi all’user id e al nome. Una volta connessi al database. viene eseguita una query in modo tale da verificare che effettivamente sia presente nella tabella Storico una transazione eseguita con id pari a quello inserito ed eseguita dall’utente con user id pari a quello inserito. In caso di corrispondenza, vengono prelevate le informazioni relative all’orario di arrivo e all’orario di partenza. A questo punto, in base alla scelta effettuata nel form, sono possibili diverse opzioni: se la targa è l’elemento da cambiare, dopo un controllo dello script, viene eseguita la modifica nella tupla contenuta della tabella Storico ed eseguito il reindirizzamento alla pagina di successo. Nel caso in cui si voglia cambiare l’orario, è necessario eseguire i controlli previsti per l’orario (contenuti nei vari file script.js, ad eccezione di questo caso). Nel caso in cui si sia verificato un errore, si viene reindirizzati alla pagina di errore. Altrimenti, si verrà reindirizzati alla pagina di successo.

ProgettoFinale/modifica_dati_account/modifica_password/index.php: in tale file, dopo essersi accertato dell’effettivo accesso eseguito dall’utente, vengono prelevati i valori inseriti nel form e le variabili di sessione relativi all’user id e al nome. Una volta connessi al database. viene eseguita una query in modo tale da verificare se l’hash della password inserita corrisponda a quello della password memorizzata. In caso di corrispondenza, viene creato un nuovo hash per la nuova password, viene eseguita l’operazione di modifica della tupla interessata contenuta nella tabella Utenti del database e reindirizzati alla pagina di successo. 

ProgettoFinale/My_account/index.php: tale file risulta strutturato come una pagina html, in cui vengono di fatto stampati i valori relativi alle variabili di sessione definite in precedenza. A tale pagina si potrà accedere solamente dopo aver effettuato l’accesso. Qui è possibile visualizzare tutti i dati inseriti dall’utente, tramite una query eseguita sulla tabella Utenti, e tutte le sue prenotazioni, tramite una query eseguita sulla tabella Storico.

ProgettoFinale/parcheggio_confermato_login/index.php: tale file contiene di fatto un riepilogo delle informazioni inserite durante la fase di prenotazione del parcheggio, il quale risulta inserito all’interno di una tabella. Esso contiene l’user id, l’id della transazione, l’orario di arrivo, l’orario di partenza e la targa.

ProgettoFinale/parcheggio_confermato_no_login/index.php: la struttura è sostanzialmente uguale a quella del file precedente, con una grande differenza tuttavia: in esso, l’user id risulterà pari a 0000000000, per cui nella tabella verrà memorizzata la dicitura “Utente non registrato”.

ProgettoFinale/password_dimenticata/index.php: in tale file viene prelevato il valore relativo all’email e, dopo essersi connesso al database, viene eseguito un controllo per verificare se tale email risulta associata ad un utente presente nella tabella: in caso di successo, si viene reindirizzati ad una pagina di successo, altrimenti, ad una pagina di errore.
